# 控制台工具包
Console Toolkit是NVDA插件，它为Windows控制台（也称为命令提示符）提供了可访问性改进。它在Windows PowerShell中也运行良好。其中一些功能可能适用于其他终端，如Cygwin、PuTTY和Windows终端，但是，该插件仅在默认的Windows控制台上进行了仔细测试。SSH用户可能会发现这个插件特别方便。

一些功能以前是[Tony增强功能附加的一部分](https://github.com/mltony/nvda-tonys'enhancements/).

## 下载

从插件商店安装。

## 跳到第一条可见线

控制台工具包覆盖了UIA控制台中的`shift+numpad7`命令：它现在读取窗口顶部的第一行，而不是读取整个缓冲区中的第一行。按两次“shift+numpad7”恢复到旧行为并读取缓冲区的第一行。

## 实时控制台语音

此选项使NVDA在控制台输出中出现新行时立即说出新行，而不是排队说出新的语音。例如，如果NVDA正忙于说出1分钟前出现在屏幕上的一行，而现在出现了一行新行，则此选项将取消说出旧行并立即开始说出新行，从而为控制台窗口中发生的事情提供更实时的反馈。

## 控制台更新发出蜂鸣声

每次更新控制台文本时，都会发出低音脉冲。

## 在控制台中强制执行Control+V

此选项使Control+V成为在“ssh”会话中工作的快捷键。

## 实验：命令提示符编辑

注意：此功能是实验性的。请仔细阅读本节，并确保在报告问题之前了解其工作原理。

按“NVDA+E”在控制台窗口中识别当前提示，并在可访问的“编辑提示”窗口中进行编辑。编辑后，您可以按“Escape”更新当前命令行，或按“Enter”更新并立即执行命令。或者，您可以按“Alt+F4”关闭编辑提示窗口，而不更新命令行。

此功能已在Windows命令提示符cmd.exe、bash shell over ssh连接以及WSL和cygwin中进行了测试。它也可能在其他Unix shell中工作，但尚未经过测试。

以下是插件如何提取当前命令。
1. 它按“行尾键”，然后发送一个控制字符，这是一个罕见的Unicode字符，不可能在任何地方使用。
2. 然后，它按下“行首”键并发送另一个控制字符。
3. 然后，它等待控制字符出现在屏幕上，这在慢速SSH连接上可能需要一些时间。
4. 命令是出现在两个控制字符之间的内容。
5. 当在NVDA设置中启用“使用UI自动化在可用时访问Windows控制台”选项时，它会在字符串的开头再发送一个控制字符。这是正确解析多行命令所必需的：UIA实现会修剪每行末尾的空格，因此为了推断两行之间是否有空格，我们需要将它们移动一个字符。但是，请注意，这样我们就不会保留单词之间的空格数量，我们只保证保留空格的存在。
6. 在编辑插件之前，请确保通过将光标放置在开头和结尾并模拟“删除”和“Backspace”键来删除控制字符。
7. 它在“编辑提示”窗口中显示命令，供用户查看或编辑。
8. 用户按下“Enter”或“Escape”后，它首先会擦除控制台中的当前行。这是通过四种方法之一实现的，方法的选择是可配置的。目前支持四种方法：
-“Control+C”：在“cmd.exe”和“bash”中都可以使用，但屏幕上会显示之前的提示；在emacs中不起作用；有时在慢速SSH连接上不可靠
-`Escape`：仅在`cmd.exe `中有效”），
-“Control+A Control+K”：适用于“bash”和“emacs”；在`cmd.exe中不起作用`
-“Backspace”（推荐）：适用于所有环境；但是速度较慢，如果线路长度发生变化，可能会导致损坏
9. 然后，插件会模拟击键以键入更新的命令，并可选择模拟按下“Enter”键。

故障排除：
- 验证控制台中的“Home”、“End”、“Delete”和“Backspace”键是否按预期工作。
- 验证您的控制台是否支持Unicode字符。一些ssh连接不支持Unicode。
- 验证所选的删除方法在您的控制台中是否有效。

## 实验：捕获命令输出

注意：此功能是实验性的。请仔细阅读本节，并确保在报告问题之前了解其工作原理。

在命令行或“编辑提示”窗口中，按“Control+Enter”捕获命令输出。此插件能够捕获跨越多个屏幕的大输出，尽管当输出大于10个屏幕时，捕获过程需要大量时间才能完成。插件将播放一个长蜂鸣声，只要插件正在捕获当前运行命令的输出，或者直到达到超时时间，蜂鸣声就会持续。或者，按“NVDA+E”中断捕获。

当在NVDA设置中启用“使用UI自动化在可用时访问Windows控制台”功能时，您可以在捕获过程中切换到其他窗口。但是，如果禁用此选项，则NVDA正在使用传统控制台代码，该代码仅在consuel聚焦时有效，因此切换到任何其他窗口都会暂停捕获。

命令捕获通过将命令输出重定向到“less”命令来工作。附加到命令的默认后缀是：

```
|小于-c2>&1
```
只有当你知道自己在做什么时，才能更改它。此插件知道如何与“less”命令的输出交互，以逐页检索输出。

在Windows上，“less.exe”工具需要单独安装。您可以通过cygwin安装它，也可以在其他地方下载windows二进制文件。

如果您在Linux中使用“tmux”或“screen”，请确保底部没有显示状态行。在运行“tmux”时
```
tmux set status off
```
删除状态行，或修改tmux.conf文件。

故障排除：
-在输出捕获尝试失败后，按控制台中的“向上箭头”检查实际执行了什么命令。
-恢复到上面提到的默认捕获后缀。
-尝试“命令提示符编辑”部分的故障排除步骤。
